<!DOCTYPE html>
<html lang="kk">
<head>
  <meta charset="UTF-8">
  <title>Найман шежіресі</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      font-family: sans-serif;
      background: white;
      margin: 20px;
    }
    h1 {
      text-align: center;
    }
    #adminPanel {
      display: none;
      text-align: center;
      margin-bottom: 10px;
    }
    .controls button {
      margin: 5px;
      padding: 6px 10px;
    }
    .search-box {
      text-align: center;
      margin: 15px;
    }
    #tree-container {
      padding: 10px;
    }
    .node {
      margin-left: 20px;
      position: relative;
    }
    .label {
      display: inline-block;
      padding: 5px 10px;
      margin: 5px 0;
      cursor: pointer;
      border-left: 2px solid #ccc;
      background: #fff;
    }
    .label.clicked {
      background: #f5f5dc;
    }
    .bold {
      font-weight: bold;
    }
    .children {
      margin-left: 20px;
      border-left: 2px dashed #ccc;
      padding-left: 10px;
    }
    .hidden {
      display: none;
    }
    .note {
      font-style: italic;
      color: #888;
    }
  </style>
</head>
<body>
  <h1>Найман шежіресі</h1>

  <div class="search-box">
    <input type="text" id="searchInput" placeholder="Шежіреден іздеу">
    <button onclick="searchTree()">Іздеу</button>
    <div id="searchResult" style="color:red; margin-top: 10px;"></div>
  </div>

  <div style="text-align:center;">
    <button onclick="login()">Шежірені өзгерту</button>
  </div>

  <div id="adminPanel">
    <div class="controls">
      <button onclick="addChild()">Ұрпақ қосу</button>
      <button onclick="editNode()">Өңдеу</button>
      <button onclick="deleteNode()">Өшіру</button>
    </div>
  </div>

  <div id="tree-container"></div>

  <script>
    const password = "Kaada2428";
    let treeData = JSON.parse(localStorage.getItem('treeData')) || {
      name: "Найман",
      children: [
        { name: "Бірінші бала" },
        { name: "Екінші бала" },
        { name: "Үшінші бала" },
        { name: "Төртінші бала" },
        { name: "Бесінші бала" },
        { name: "Алтыншы бала" },
        { name: "Жетінші бала" },
        { name: "Сегізінші бала" },
        { name: "Тоғызыншы бала" },
        { name: "Оныншы бала" }
      ]
    };
    let selectedPath = [];

    function saveData() {
      localStorage.setItem('treeData', JSON.stringify(treeData));
    }

    function renderTree(container, node, path = []) {
      container.innerHTML = '';
      const build = (parent, node, path) => {
        const nodeDiv = document.createElement('div');
        nodeDiv.className = 'node';

        const label = document.createElement('div');
        label.className = 'label';
        if (node.bold) label.classList.add('bold');
        if (JSON.stringify(path) === JSON.stringify(selectedPath)) {
          label.classList.add('clicked');
        }

        label.textContent = node.name || '';
        if (node.nickname) label.textContent += ` (${node.nickname})`;
        if (node.date) label.textContent += ` ${node.date}`;
        if (node.note) label.textContent += ` *`;

        label.onclick = () => {
          document.querySelectorAll('.label').forEach(el => el.classList.remove('clicked'));
          label.classList.add('clicked');
          selectedPath = path;
        };

        nodeDiv.appendChild(label);

        if (node.children && node.children.length > 0) {
          const childContainer = document.createElement('div');
          childContainer.className = 'children';
          node.children.forEach((child, i) => {
            build(childContainer, child, path.concat(i));
          });
          nodeDiv.appendChild(childContainer);
        }

        parent.appendChild(nodeDiv);
      };

      build(container, node, []);
    }

    function login() {
      const input = prompt("Құпия сөзді енгізіңіз:");
      if (input === password) {
        document.getElementById("adminPanel").style.display = "block";
      } else {
        alert("Қате құпия сөз!");
      }
    }

    function getNode(path) {
      return path.reduce((obj, i) => obj.children[i], treeData);
    }

    function addChild() {
      if (!selectedPath) return alert("Адамды таңдаңыз.");
      const name = prompt("Есімі:");
      if (!name) return;
      const nickname = prompt("Лақап аты:");
      const date = prompt("Туған жылы:");
      const note = prompt("Түсініктеме:");
      const bold = confirm("Қара түспен белгілеу керек пе?");
      const node = getNode(selectedPath);
      if (!node.children) node.children = [];
      node.children.push({ name, nickname, date, note, bold });
      saveData();
      renderTree(document.getElementById('tree-container'), treeData);
    }

    function editNode() {
      const node = getNode(selectedPath);
      const name = prompt("Есімі:", node.name);
      const nickname = prompt("Лақап аты:", node.nickname || "");
      const date = prompt("Туған жылы:", node.date || "");
      const note = prompt("Түсініктеме:", node.note || "");
      const bold = confirm("Қара түспен белгілеу керек пе?");
      Object.assign(node, { name, nickname, date, note, bold });
      saveData();
      renderTree(document.getElementById('tree-container'), treeData);
    }

    function deleteNode() {
      if (selectedPath.length === 0) return alert("Тамырды өшіруге болмайды.");
      const parent = getNode(selectedPath.slice(0, -1));
      parent.children.splice(selectedPath[selectedPath.length - 1], 1);
      selectedPath = [];
      saveData();
      renderTree(document.getElementById('tree-container'), treeData);
    }

    function searchTree() {
      const term = document.getElementById("searchInput").value.toLowerCase();
      if (!term) return;

      let found = false;

      function traverse(node, path = []) {
        if ((node.name || "").toLowerCase().includes(term)) {
          selectedPath = path;
          found = true;
        }
        if (node.children) {
          node.children.forEach((child, i) => {
            traverse(child, path.concat(i));
          });
        }
      }

      traverse(treeData);
      if (found) {
        document.getElementById("searchResult").textContent = "";
      } else {
        document.getElementById("searchResult").textContent = "Шежіреден табылмады";
      }
      renderTree(document.getElementById('tree-container'), treeData);
    }

    renderTree(document.getElementById('tree-container'), treeData);
  </script>
</body>
</html>