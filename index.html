<!DOCTYPE html>
<html lang="kk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–ù–∞–π–º–∞–Ω —à–µ–∂—ñ—Ä–µ—Å—ñ</title>
  <style>
    body { font-family: sans-serif; background: #f5f5f5; padding: 2em; margin: 0; max-width: 1000px; margin: auto; }
    h1 { text-align: center; }
    .tree ul { padding-left: 1.5em; position: relative; }
    .tree ul::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0.75em;
      border-left: 1px solid #aaa;
      height: 100%;
    }
    .tree li {
      margin: 0;
      padding: 0.5em 0 0.5em 1em;
      position: relative;
    }
    .tree li::before {
      content: '';
      position: absolute;
      top: 1.1em;
      left: 0;
      width: 0.75em;
      border-top: 1px solid #aaa;
    }
    .node {
      display: inline-block;
      padding: 0.3em 0.6em;
      border-radius: 4px;
      background: white;
      transition: background 0.3s;
      cursor: pointer;
    }
    .node.selected {
      background: #fff2b8;
      border: 1px solid #d4b400;
    }
    .actions button {
      margin-left: 0.3em;
      padding: 0.2em 0.5em;
      font-size: 0.9em;
    }
    .node input {
      font-size: 1em;
      width: auto;
    }
    #authBox { text-align: center; margin-bottom: 2em; }
  </style>
</head>
<body>

  <h1>–ù–∞–π–º–∞–Ω —à–µ–∂—ñ—Ä–µ—Å—ñ</h1>

  <div id="authBox">
    <input type="password" id="adminPass" placeholder="“ö“±–ø–∏—è —Å”©–∑–¥—ñ –µ–Ω–≥—ñ–∑—ñ“£—ñ–∑" />
    <button onclick="auth()">–ö—ñ—Ä—É</button>
  </div>

  <div class="tree" id="treeContainer"></div>

  <script>
    const PASSWORD = "Kaada2428";
    let isAdmin = false;
    let selectedEl = null;

    const sampleTree = {
      name: "–ù–∞–π–º–∞–Ω",
      children: [
        {
          name: "“ö–∞—Ä–∞–∫–µ—Ä–µ–π",
          children: [
            {
              name: "“ö–∞–±–∞–Ω–±–∞–π",
              children: [
                {
                  name: "–ñ–∞–Ω”ô–±—ñ–ª",
                  children: [
                    { name: "–ë–µ—Ä—ñ–∫", children: [{ name: "–ù“±—Ä–∂–∞–Ω" }, { name: "–ê—Å“õ–∞—Ä" }] },
                    { name: "–ú–µ–π—Ä–∞–º", children: [{ name: "–ï—Ä–∂–∞–Ω" }, { name: "–¢–∞–ª“ì–∞—Ç" }] }
                  ]
                }
              ]
            }
          ]
        }
      ]
    };

    function loadTree() {
      const data = localStorage.getItem("naiVerticalTree");
      return data ? JSON.parse(data) : sampleTree;
    }

    function saveTree() {
      localStorage.setItem("naiVerticalTree", JSON.stringify(treeData));
    }

    function renderNode(node, parentArray, index) {
      const li = document.createElement("li");
      const span = document.createElement("span");
      span.className = "node";
      span.textContent = node.name;

      span.onclick = () => {
        if (selectedEl) selectedEl.classList.remove("selected");
        span.classList.add("selected");
        selectedEl = span;
      };

      if (isAdmin) {
        const input = document.createElement("input");
        input.value = node.name;
        input.onchange = () => {
          node.name = input.value;
          saveTree();
        };
        span.textContent = "";
        span.appendChild(input);
      }

      li.appendChild(span);

      if (isAdmin) {
        const actions = document.createElement("span");
        actions.className = "actions";

        const addBtn = document.createElement("button");
        addBtn.textContent = "+";
        addBtn.title = "“∞—Ä–ø–∞“õ “õ–æ—Å—É";
        addBtn.onclick = () => {
          if (!node.children) node.children = [];
          node.children.push({ name: "–ñ–∞“£–∞ –∞—Ç", children: [] });
          draw();
        };
        actions.appendChild(addBtn);

        if (parentArray) {
          const delBtn = document.createElement("button");
          delBtn.textContent = "üóë";
          delBtn.title = "–ñ–æ—é";
          delBtn.onclick = () => {
            parentArray.splice(index, 1);
            draw();
          };
          actions.appendChild(delBtn);
        }

        li.appendChild(actions);
      }

      if (node.children && node.children.length > 0) {
        const ul = document.createElement("ul");
        node.children.forEach((child, i) => {
          ul.appendChild(renderNode(child, node.children, i));
        });
        li.appendChild(ul);
      }

      return li;
    }

    function draw() {
      const container = document.getElementById("treeContainer");
      container.innerHTML = "";
      const ul = document.createElement("ul");
      ul.appendChild(renderNode(treeData));
      container.appendChild(ul);
      saveTree();
    }

    function auth() {
      const input = document.getElementById("adminPass").value;
      if (input === PASSWORD) {
        isAdmin = true;
        document.getElementById("authBox").style.display = "none";
        draw();
      } else {
        alert("“ö“±–ø–∏—è —Å”©–∑ “õ–∞—Ç–µ.");
      }
    }

    let treeData = loadTree();
    draw();
  </script>
</body>
</html>
