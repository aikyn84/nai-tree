<!-- index.html -->
<!DOCTYPE html>
<html lang="kk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Найман шежіресі</title>
  <style>
    body { font-family: sans-serif; background: #f5f5f5; padding: 2em; max-width: 1000px; margin: auto; }
    h1 { text-align: center; }
    .tree ul { list-style: none; padding-left: 1em; margin-left: 1em; border-left: 1px solid #ccc; }
    .tree li { margin: 0.5em 0 0.5em 1em; position: relative; }
    .tree li::before {
      content: '';
      position: absolute;
      top: 1em;
      left: -1em;
      width: 1em;
      height: 0;
      border-top: 1px solid #ccc;
    }
    .node {
      padding: 0.3em 0.6em;
      background: #fff;
      border-radius: 4px;
      cursor: pointer;
      display: inline-block;
      transition: background 0.3s;
    }
    .node.selected {
      background: #fff2b8;
      border: 1px solid #d4b400;
    }
    .toggle {
      cursor: pointer;
      margin-right: 0.3em;
      font-weight: bold;
    }
    .hidden { display: none; }
  </style>
</head>
<body>
  <h1>Найман шежіресі</h1>
  <div class="tree" id="treeContainer"></div>

  <script>
    const TREE_KEY = "naiFoldState";
    const treeData = {
      name: "Найман",
      children: [
        {
          name: "Қаракерей",
          children: [
            {
              name: "Қабанбай",
              children: [
                {
                  name: "Жанәбіл",
                  children: [
                    { name: "Берік", children: [{ name: "Нұржан" }, { name: "Асқар" }] },
                    { name: "Мейрам", children: [{ name: "Ержан" }, { name: "Талғат" }] }
                  ]
                }
              ]
            }
          ]
        }
      ]
    };

    let selectedNode = null;
    let state = JSON.parse(localStorage.getItem(TREE_KEY) || "{}");

    function saveState() {
      localStorage.setItem(TREE_KEY, JSON.stringify(state));
    }

    function toggle(branchId) {
      state[branchId] = !state[branchId];
      saveState();
      draw();
    }

    function render(node, path = "root") {
      const li = document.createElement("li");

      if (node.children && node.children.length) {
        const toggleBtn = document.createElement("span");
        const isOpen = state[path] !== false;
        toggleBtn.textContent = isOpen ? "▼" : "▶";
        toggleBtn.className = "toggle";
        toggleBtn.onclick = () => toggle(path);
        li.appendChild(toggleBtn);

        const nameSpan = document.createElement("span");
        nameSpan.className = "node";
        nameSpan.textContent = node.name;
        if (selectedNode === path) nameSpan.classList.add("selected");
        nameSpan.onclick = () => {
          selectedNode = path;
          draw();
        };
        li.appendChild(nameSpan);

        const ul = document.createElement("ul");
        if (!isOpen) ul.classList.add("hidden");
        node.children.forEach((child, i) => {
          ul.appendChild(render(child, `${path}.${i}`));
        });
        li.appendChild(ul);
      } else {
        const nameSpan = document.createElement("span");
        nameSpan.className = "node";
        nameSpan.textContent = node.name;
        if (selectedNode === path) nameSpan.classList.add("selected");
        nameSpan.onclick = () => {
          selectedNode = path;
          draw();
        };
        li.appendChild(nameSpan);
      }

      return li;
    }

    function draw() {
      const container = document.getElementById("treeContainer");
      container.innerHTML = "";
      const ul = document.createElement("ul");
      ul.appendChild(render(treeData));
      container.appendChild(ul);
    }

    draw();
  </script>
</body>
</html>